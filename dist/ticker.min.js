/*! ticker May-01-2016 */
!function ticker_go(){function pseudoForEach(a,b,c){for(var d=0;d<a.length;d++)b.call(c,d,a[d])}function assignStyle(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])}function getUrlParamValue(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href);return null===d?null:d[1]}function config(a){for(var b in a)oConfig[b]=a[b]}function print(a,b){oConfig.silentMode===!0&&b&&!b.overrideSilentMode||(b&&b.textarea&&_renderTextarea(a),b&&b.internal!==!0&&aBuffer.unshift(a),aRenderBuffer.unshift(a),_flushBuffer())}function test(){return oConfig.pauseMode===!0?void _nonSavedPrint("pauseMode"):void print("test: "+new Date,{overrideSilentMode:!0})}function help(){oConfig.pauseMode=!1,kill(),oConfig.interval=oDEFAULTS.interval,oConfig.logStartTop=oDEFAULTS.logStartTop;for(var a=0;a<aHelp.length;a++){var b=aHelp[a];b=b.replace(/\_/g,"&nbsp;"),print(b,{overrideSilentMode:!0})}}function kill(){oConfig.pauseMode=!1,aRenderBuffer=[];var a=document.querySelectorAll("._ticker");pseudoForEach(a,function(a,b){b.parentNode.removeChild(b)})}function pause(){print(oConfig.pauseMode?"pause off":"paused"),oConfig.pauseMode=!oConfig.pauseMode}function output(a){void 0===a&&(a=!1);var b="";if(a===!0)aBuffer.forEach(function(a){b+=a+"\n"});else{var c=document.querySelectorAll("._ticker_log");c.length>0&&pseudoForEach(c,function(a,c){var d=c.innerHTML.trim();d=d.replace(/&nbsp;/g,""),b+=d+"\n"})}_toggleTextarea({text:b,source:KEYS.O})}function outputAll(){output(!0)}function dump(){var a="";aConfigurableKeys.forEach(function(b){a+=b+": "+oConfig[b]+"\n"}),a+="listening to console."+oConfig.channel+"\n",_toggleTextarea({text:a,source:KEYS.D})}function silent(){oConfig.silentMode===!0?(oConfig.silentMode=!1,print("silent mode off")):oConfig.silentMode=!0}function increaseSpeed(){return oConfig.pauseMode?void _nonSavedPrint("pauseMode"):(oConfig.interval-=oConfig.adjustmentInterval/2,void print("speed: "+oConfig.interval))}function decreaseSpeed(){return oConfig.pauseMode?void _nonSavedPrint("pauseMode"):(oConfig.interval+=oConfig.adjustmentInterval,void print("speed: "+oConfig.interval))}function moveRight(){oConfig.align="right",_postConfigApply();var a=document.querySelectorAll("._ticker_log");pseudoForEach(a,function(a,b){b.style.right=0,b.style.left="inherit",b.style["text-align"]="right"}),test()}function moveLeft(){oConfig.align="left",_postConfigApply();var a=document.querySelectorAll("._ticker_log");pseudoForEach(a,function(a,b){b.style.left=0,b.style.right="inherit",b.style["text-align"]="left"}),test()}function saveConfig(){function a(){var a="_ticker={";return aConfigurableKeys.forEach(function(b){void 0!==oDEFAULTS[b]&&oDEFAULTS[b]===oConfig[b]||(a+="%22"+b+"%22:",a+="string"==typeof oConfig[b]?"%22"+oConfig[b]+"%22":oConfig[b],a+=",")}),a+="}",a=a.replace(/,}/,"}")}var b=window.location.href;b=b.replace(/_ticker=({.*})?&?/,""),-1===b.indexOf("?")&&(b+="?1=1"),b=b+"&"+a(),b=b.replace(/\?1=1&/,"?"),b=b.replace(/\?&/,"?"),b=b.replace(/(&&)+/,"&"),history.pushState?window.history.pushState({path:b},"",b):window.location.replace(b)}function moveUp(){return oConfig.pauseMode?void _nonSavedPrint("pauseMode"):(kill(),oConfig.logStartTop+=5,void print("start: "+oConfig.logStartTop))}function moveDown(){return oConfig.pauseMode?void _nonSavedPrint("pauseMode"):(kill(),oConfig.logStartTop-=5,void print("start: "+oConfig.logStartTop))}function registerMacro(a,b){return 9===a?void console.log("`","macro 9 reserved for interactive macro (`m)"):(console.log("`","registering macro: "+a),void(aMacros[a]=b))}function macroEdit(){var sDefaultText=oConfig.sMacro9Code;_toggleTextarea({text:sDefaultText,source:KEYS.M,buttons:{clear:function(){killTextarea(),macroEdit()}},exit:function(sValue){oConfig.sMacro9Code=sValue,console.log("`","registering macro: 9"),aMacros[9]=function(){eval(sValue)}}})}function runMacro(a){"function"==typeof aMacros[a]?(console.log("`","running macro: "+a),aMacros[a]()):console.log("`","macro empty")}function nextChannel(){for(var a=0,b=oConfig.channel;a<aChannels.length&&aChannels[a]!==b;a++);_listenToChannel(aChannels[(a+1)%aChannels.length]),print("listening to "+oConfig.channel)}function killTextarea(){var a=document.getElementById(sTextareaId);a&&a.parentNode.removeChild(a)}function restoreAndExit(){window.clearInterval(render_interval),kill(),killTextarea(),document.body.removeEventListener("keydown",fnKeyDown),document.body.removeEventListener("keyup",fnKeyUp),window._ticker=void 0,delete window._ticker,aChannels.forEach(function(a){console[a]=oChannels[a].fnOriginal})}function reset(){restoreAndExit(),ticker_go()}function _nonSavedPrint(a){print(a,{overrideSilentMode:!1,internal:!0})}function _startInterval(){var a=function(){if(window.clearInterval(render_interval),!oConfig.pauseMode){var b=document.querySelectorAll("._ticker_log");b.length>0&&pseudoForEach(b,function(a,b){var c=parseInt(getComputedStyle(b).top,10);if(0>=c)b.parentNode.removeChild(b);else{var d=c-b.offsetHeight+"px";b.style.top=d}})}render_interval=setInterval(a,oConfig.interval)};render_interval=setInterval(a,oConfig.interval)}function _postConfigApply(){function a(){"right"===oConfig.align?(oConfig.logStyle.right=0,oConfig.logStyle.left="inherit",oConfig.logStyle["text-align"]="right"):(oConfig.logStyle.right="inherit",oConfig.logStyle.left=0,oConfig.logStyle["text-align"]="left")}a()}function _loadConfigFromUrl(){var a,b=getUrlParamValue("_ticker");if(null!==b){try{a=JSON.parse(decodeURIComponent(b))}catch(c){}if("object"==typeof a)for(var d in a)oConfig[d]=a[d]}}function _setupListeners(){fnKeyDown=function(a){if(keyIsDown===!1&&a.keyCode===KEYS.BackTick&&(keyIsDown=!0),keyIsDown===!0){a.preventDefault();var b={};b[KEYS.B]=function(){oConfig.requireBackTick=!oConfig.requireBackTick,print("requireBackTick: "+oConfig.requireBackTick)},b[KEYS.D]=dump,b[KEYS.S]=silent,b[KEYS.T]=test,b[KEYS.O]=output,b[KEYS.L]=outputAll,b[KEYS.P]=pause,b[KEYS.K]=kill,b[KEYS.H]=help,b[KEYS.M]=macroEdit,b[KEYS.Up]=increaseSpeed,b[KEYS.Down]=decreaseSpeed,b[KEYS.Right]=moveRight,b[KEYS.Left]=moveLeft,b[KEYS.PageDown]=moveDown,b[KEYS.PageUp]=moveUp,b[KEYS.Enter]=saveConfig,b[KEYS.Tab]=nextChannel,b[KEYS.Esc]=killTextarea,[0,1,2,3,4,5,6,7,8,9].forEach(function(a){b[KEYS[a]]=function(){runMacro(a)}}),"function"==typeof b[a.keyCode]&&b[a.keyCode]()}},fnKeyUp=function(a){keyIsDown===!0&&-1===aActionKeys.indexOf(a.keyCode)&&(keyIsDown=!1)},document.body.addEventListener("keydown",fnKeyDown),document.body.addEventListener("keyup",fnKeyUp)}function _calculateTop(){var a=document.querySelector("._ticker_log:last-child");return a?parseInt(a.style.top,10)+a.offsetHeight:oConfig.logStartTop}function _renderText(a){var b=document.createElement("div");b.className="_ticker",assignStyle(b,oConfig.logStyle),b.className+=" _ticker_log",b.innerHTML=a;var c=_calculateTop();c<oConfig.logStartTop/2&&(c=oConfig.logStartTop),b.style.top=c+"px",document.body.appendChild(b)}function _flushBuffer(){for(;aRenderBuffer.length>0&&_calculateTop()<iAllowedHeight;)_renderText(aRenderBuffer.pop())}function _listenToChannel(a){var b=oConfig.channel;b&&"function"==typeof oChannels[b].fnOriginal&&(console[b]=oChannels[b].fnOriginal),oConfig.channel=a,console[a]=function(b,c){var d=b;"`"===b&&(d=c),oConfig.requireBackTick===!1?print(d):oConfig.requireBackTick===!0&&"`"===b?print(d):oChannels[a].fnOriginal.apply(this,[arguments])}}function _renderTextarea(a){var b=window.innerHeight,c=window.innerWidth,d=document.createElement("div");d.id=sTextareaId,d.style.position="fixed",d.style.left=0,d.style.top=0,d.style["z-index"]=9999,d.style.width=c/3+"px",d.style.height=b-10+"px";var e=document.createElement("textarea");e.style.height="100%",e.style.width="100%",e.innerHTML=a,d.appendChild(e),document.body.appendChild(d)}function _toggleTextarea(a){oConfig.lastTextareaAction!==a.source&&killTextarea(),oConfig.lastTextareaAction=a.source;var b;if(document.getElementById(sTextareaId)){if(oConfig.pauseMode=!1,"function"==typeof a.exit){b=document.getElementById(sTextareaId);var c=b.querySelectorAll("textarea")[0];a.exit(c.value)}killTextarea()}else if(oConfig.pauseMode=!0,_renderTextarea(a.text),b=document.getElementById(sTextareaId),"object"==typeof a.buttons){var d=document.createElement("div");d.style.position="absolute",d.style.bottom=0,d.style.left=0,d.style.height="20px",d.style.borderTopWidth="1px",d.style.borderTopStyle="solid",d.style.width="100%",d.style.paddingTop="5px";for(var e in a.buttons)if(a.buttons.hasOwnProperty(e)){var f=document.createElement("button");f.innerHTML=e,f.onclick=a.buttons[e],f.style["float"]="left",d.appendChild(f)}b.appendChild(d)}}var aChannels=["log","debug","warn","error","trace"],oChannels={},oDEFAULTS={interval:300,logStartTop:100,align:"left",requireBackTick:!0,channel:"log"},oConfig={silentMode:!1,pauseMode:!1,adjustmentInterval:25,lastTextareaAction:void 0,sMacro9Code:"// macro 9\r\r",logStyle:{position:"fixed",color:"black","background-color":"#F2F2F2",padding:"1px","z-index":9998,top:0,left:0,"font-family":"monospace","font-size":"14px",opacity:.85}},aBuffer=[],aRenderBuffer=[],render_interval,aMacros={},iAllowedHeight=1.25*window.innerHeight,aConfigurableKeys=["interval","logStartTop","align","requireBackTick","channel"],sTextareaId="_tickerTextarea",keyIsDown=!1,fnKeyDown,fnKeyUp,aHelp=["________________________________________________","ticker__________________________________________","________________________________________________","Hold the backtick (`) key down to enter commands","________________________________________________","h -> help_______________________________________","t -> test_______________________________________","p -> pause (freeze output toggle)_______________","k -> kill (remove all)__________________________","o -> output (show output in textarea toggle)____","0 -> output all (show entire log history)_______","d -> dump (show configuration values)___________","b -> back-tick required to console invocation___","________________________________________________","up ______-> increase speed______________________","down ____-> decrease speed______________________","right ___-> move logs right_____________________","left ____-> move logs left______________________","pageup __-> increase starting point_____________","pagedown -> decrease starting point_____________","________________________________________________","enter -> save configuration in url______________","c ____-> clear configuration in url_____________","________________________________________________","________________________________________________","Print to the screen:____________________________",'  >> console.log("`", "lorum ipsum...")_________',"________________________________________________","-","-","-"],KEYS={Tab:9,Enter:13,Esc:27,PageDown:33,PageUp:34,Left:37,Up:38,Right:39,Down:40,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,H:72,K:75,L:76,M:77,O:79,P:80,S:83,T:84,BackTick:192},aActionKeys=[KEYS.Tab,KEYS.Esc,KEYS.PageDown,KEYS.PageUp,KEYS.Left,KEYS.Up,KEYS.Right,KEYS.Down,KEYS[0],KEYS[1],KEYS[2],KEYS[3],KEYS[4],KEYS[5],KEYS[6],KEYS[7],KEYS[8],KEYS[9],KEYS.A,KEYS.B,KEYS.C,KEYS.D,KEYS.H,KEYS.K,KEYS.L,KEYS.M,KEYS.O,KEYS.P,KEYS.S,KEYS.T];aChannels.forEach(function(a){oChannels[a]={fnOriginal:console[a]}});for(var sKey in oDEFAULTS)oConfig[sKey]=oDEFAULTS[sKey];_loadConfigFromUrl(),_postConfigApply(),_listenToChannel(oConfig.channel),setInterval(function(){_flushBuffer()},250),_startInterval(),_setupListeners(),function(){var a={};a.config=config,a.test=test,a.help=help,a.kill=kill,a.silent=silent,a.pause=pause,a.output=output,a.outputAll=outputAll,a.dump=dump,a.moveDown=moveDown,a.moveUp=moveUp,a.moveLeft=moveLeft,a.moveRight=moveRight,a.increaseSpeed=increaseSpeed,a.decreaseSpeed=decreaseSpeed,a.nextChannel=nextChannel,a.print=print,a.registerMacro=registerMacro,a.runMacro=runMacro,a.macroEdit=macroEdit,a.restoreAndExit=restoreAndExit,a.reset=reset,a._oConfig=oConfig,window._ticker=a}()}();