/* https://github.com/jonbri/ticker-log v0.2.1 Fri May 27 12:13:45 EDT 2016 */
!function ticker_go(){function pseudoForEach(e,n,o){for(var t=0;t<e.length;t++)n.call(o,t,e[t])}function assignStyle(e,n){for(var o in n)n.hasOwnProperty(o)&&(e.style[o]=n[o])}function getUrlParamValue(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n="[\\?&]"+e+"=([^&#]*)",o=new RegExp(n),t=o.exec(window.location.href);return null===t?null:t[1]}function isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}function config(e){var n=isArray(e.channels);n&&(e.previousChannels=oConfig.channels);for(var o in e)oConfig[o]=e[o];n&&_listenToChannels()}function print(e,n){n=n||{},void 0!==e&&null!==e&&oConfig.silentMode!==!0&&("function"==typeof fnFilterFunction&&fnFilterFunction(e)!==!0||(n.textarea&&_renderTextarea(e),n.internal!==!0&&aBuffer.unshift(e),aRenderBuffer.unshift(e),_flushBuffer()))}function test(){return oConfig.pauseMode===!0?void _nonSavedPrint("pauseMode"):void print("test: "+new Date)}function help(){oConfig.pauseMode=!1,kill(),oConfig.logStartTop=oDEFAULTS.logStartTop;for(var e=0;e<aHelp.length;e++){var n=aHelp[e];n=n.replace(/\_/g,"&nbsp;"),print(n)}}function kill(){oConfig.pauseMode=!1,aRenderBuffer=[];var e=document.querySelectorAll("._ticker_log");pseudoForEach(e,function(e,n){n.parentNode.removeChild(n)})}function pause(){print(oConfig.pauseMode?"pause off":"paused"),oConfig.pauseMode=!oConfig.pauseMode}function output(e){void 0===e&&(e=!1);var n="";if(e===!0)aBuffer.forEach(function(e){n+=e+"\n"});else{var o=document.querySelectorAll("._ticker_log");o.length>0&&pseudoForEach(o,function(e,o){var t=o.innerHTML.trim();t=t.replace(/&nbsp;/g,""),n+=t+"\n"})}_toggleTextarea({text:n,source:KEYS.O})}function outputAll(){output(!0)}function dump(){var e="";aConfigurableKeys.forEach(function(n){e+=n+": "+oConfig[n]+"\n"}),e+="listening to console: "+oConfig.channels+"\n",_toggleTextarea({text:e,source:KEYS.D})}function silent(){oConfig.silentMode===!0?(oConfig.silentMode=!1,print("silent mode off")):oConfig.silentMode=!0}function increaseSpeed(){return oConfig.pauseMode?void _nonSavedPrint("pauseMode"):(oConfig.interval-=oConfig.adjustmentInterval/2,void print("speed: "+oConfig.interval))}function decreaseSpeed(){return oConfig.pauseMode?void _nonSavedPrint("pauseMode"):(oConfig.interval+=oConfig.adjustmentInterval,void print("speed: "+oConfig.interval))}function moveRight(){oConfig.align="right",_postConfigApply();var e=document.querySelectorAll("._ticker_log");pseudoForEach(e,function(e,n){n.style.right=0,n.style.left="inherit",n.style["text-align"]="right"}),test()}function moveLeft(){oConfig.align="left",_postConfigApply();var e=document.querySelectorAll("._ticker_log");pseudoForEach(e,function(e,n){n.style.left=0,n.style.right="inherit",n.style["text-align"]="left"}),test()}function saveConfig(){function e(){var e="_ticker={";return aConfigurableKeys.forEach(function(n){void 0!==oDEFAULTS[n]&&oDEFAULTS[n]===oConfig[n]||(e+="%22"+n+"%22:",e+="string"==typeof oConfig[n]?"%22"+oConfig[n]+"%22":oConfig[n],e+=",")}),1!==oConfig.channels.length&&"log"!==oConfig.channels[0]&&(e+="%22channels%22:",e+="%22"+oConfig.channels+"%22"),1===oConfig.defaultBacktickKeys.length&&oConfig.defaultBacktickKeys[0]===KEYS.BackTick||(e+="%22defaultBacktickKeys%22:",e+="%22"+oConfig.defaultBacktickKeys+"%22"),e+="}",e=e.replace(/,}/,"}")}var n=window.location.href;n=n.replace(/_ticker=({.*})?&?/,""),-1===n.indexOf("?")&&(n+="?1=1"),n=n+"&"+e(),n=n.replace(/\?1=1&/,"?"),n=n.replace(/\?&/,"?"),n=n.replace(/(&&)+/,"&"),history.pushState?window.history.pushState({path:n},"",n):window.location.replace(n)}function increaseLogStartTop(){return oConfig.pauseMode?void _nonSavedPrint("pauseMode"):(kill(),oConfig.logStartTop+=5,void print("start: "+oConfig.logStartTop))}function decreaseLogStartTop(){return oConfig.pauseMode?void _nonSavedPrint("pauseMode"):(kill(),oConfig.logStartTop-=5,void print("start: "+oConfig.logStartTop))}function registerMacro(e,n){return 9===e?void console.log("`","macro 9 reserved for interactive macro (`m)"):(console.log("`","registering macro: "+e),void(aMacros[e]=n))}function macroEdit(){var sDefaultText=oConfig.sMacro9Code;_toggleTextarea({text:sDefaultText,source:KEYS.M,buttons:{clear:function(){killTextarea(),macroEdit()}},exit:function(sValue){oConfig.sMacro9Code=sValue,console.log("`","registering macro: 9"),aMacros[9]=function(){eval(sValue)}}})}function runMacro(e){"function"==typeof aMacros[e]?(console.log("`","running macro: "+e),aMacros[e]()):console.log("`","macro empty")}function nextChannel(){var e=0,n=oConfig.channels[0];for(oConfig.channels.length>1&&(n="trace");e<aChannels.length&&aChannels[e]!==n;e++);oConfig.previousChannels=oConfig.channels,oConfig.channels=[aChannels[(e+1)%aChannels.length]],_listenToChannels(),print("listening to "+oConfig.channels[0])}function killTextarea(){var e=document.getElementById(sTextareaId);e&&e.parentNode.removeChild(e)}function restoreAndExit(){window.clearInterval(render_interval),kill(),killTextarea(),document.body.removeEventListener("keydown",fnKeyDown),document.body.removeEventListener("keyup",fnKeyUp),window._ticker=void 0,delete window._ticker,aChannels.forEach(function(e){console[e]=oChannels[e].fnOriginal})}function reset(){restoreAndExit(),ticker_go()}function filter(e){e&&("string"==typeof e?fnFilterFunction=function(n){return-1!==n.indexOf(e)}:e instanceof RegExp?fnFilterFunction=function(n){return e.test(n)}:"function"==typeof e&&(fnFilterFunction=e))}function listenToEverything(){config({requireBackTick:!1,channels:aChannels}),_listenToChannels()}function _nonSavedPrint(e){print(e,{internal:!0})}function _startInterval(){var e=function(){if(window.clearInterval(render_interval),!oConfig.pauseMode){var n=document.querySelectorAll("._ticker_log");n.length>0&&pseudoForEach(n,function(e,n){var o=parseInt(getComputedStyle(n).top,10);if(0>=o)n.parentNode.removeChild(n),n=null;else{var t=o-n.offsetHeight+"px";n.style.top=t}})}render_interval=setInterval(e,oConfig.interval)};render_interval=setInterval(e,oConfig.interval)}function _postConfigApply(){function e(){"right"===oConfig.align?(oConfig.logStyle.right=0,oConfig.logStyle.left="inherit",oConfig.logStyle["text-align"]="right"):(oConfig.logStyle.right="inherit",oConfig.logStyle.left=0,oConfig.logStyle["text-align"]="left")}e()}function _loadConfigFromUrl(){var e,n=getUrlParamValue("_ticker");if(null!==n){try{e=JSON.parse(decodeURIComponent(n))}catch(o){}if("object"==typeof e)for(var t in e)"channels"===t?oConfig.channels=e[t].split(","):"defaultBacktickKeys"===t?oConfig.defaultBacktickKeys=e[t].split(",").map(function(e){return parseInt(e)}):oConfig[t]=e[t]}}function _setupListeners(){fnKeyDown=function(e){if(keyIsDown===!1&&-1!==oConfig.defaultBacktickKeys.indexOf(e.keyCode)&&(keyIsDown=!0),keyIsDown===!0){e.preventDefault();var n={};n[KEYS.B]=function(){oConfig.requireBackTick=!oConfig.requireBackTick,print("requireBackTick: "+oConfig.requireBackTick)},n[KEYS.D]=dump,n[KEYS.S]=silent,n[KEYS.T]=test,n[KEYS.O]=output,n[KEYS.L]=outputAll,n[KEYS.P]=pause,n[KEYS.K]=kill,n[KEYS.H]=help,n[KEYS.M]=macroEdit,n[KEYS.Up]=increaseSpeed,n[KEYS.Down]=decreaseSpeed,n[KEYS.Right]=moveRight,n[KEYS.Left]=moveLeft,n[KEYS.PageDown]=decreaseLogStartTop,n[KEYS.PageUp]=increaseLogStartTop,n[KEYS.Enter]=saveConfig,n[KEYS.Tab]=nextChannel,n[KEYS.Esc]=killTextarea,[0,1,2,3,4,5,6,7,8,9].forEach(function(e){n[KEYS[e]]=function(){runMacro(e)}}),"function"==typeof n[e.keyCode]&&n[e.keyCode]()}},fnKeyUp=function(e){keyIsDown===!0&&-1===aActionKeys.indexOf(e.keyCode)&&(keyIsDown=!1)},document.body.addEventListener("keydown",fnKeyDown),document.body.addEventListener("keyup",fnKeyUp)}function _calculateTop(){var e=document.querySelector("._ticker_log:last-child");return e?parseInt(e.style.top,10)+e.offsetHeight:oConfig.logStartTop}function _renderText(e){var n=document.createElement("div");assignStyle(n,oConfig.logStyle),n.className+=" _ticker_log",n.innerHTML=e;var o=_calculateTop();o<oConfig.logStartTop/2&&(o=oConfig.logStartTop),n.style.top=o+"px",n.addEventListener("click",function(){pause()}),document.body.appendChild(n)}function _flushBuffer(){for(;aRenderBuffer.length>0&&_calculateTop()<iAllowedHeight;)_renderText(aRenderBuffer.pop())}function _listenToChannels(){isArray(oConfig.previousChannels)&&oConfig.previousChannels.forEach(function(e){"function"==typeof oChannels[e].fnOriginal&&(console[e]=oChannels[e].fnOriginal)}),oConfig.channels.forEach(function(e){console[e]=function(n,o){var t=n;"`"===n&&(t=o),oConfig.requireBackTick===!1?print(t):oConfig.requireBackTick===!0&&"`"===n?print(t):oChannels[e].fnOriginal.apply(this,[arguments])}})}function _renderTextarea(e){var n,o=window.innerHeight,t=window.innerWidth;document.getElementById(sTextareaId)&&killTextarea(),n=document.createElement("div"),n.id=sTextareaId,n.style.position="fixed",n.style.left=0,n.style.top=0,n.style["z-index"]=9999,n.style.width=t/3+"px",n.style.height=o-10+"px";var _=document.createElement("textarea");_.style.height="100%",_.style.width="100%",_.innerHTML=e,n.appendChild(_),document.body.appendChild(n)}function _toggleTextarea(e){oConfig.lastTextareaAction!==e.source&&killTextarea(),oConfig.lastTextareaAction=e.source;var n;if(document.getElementById(sTextareaId)){if(oConfig.pauseMode=!1,"function"==typeof e.exit){n=document.getElementById(sTextareaId);var o=n.querySelectorAll("textarea")[0];e.exit(o.value)}killTextarea()}else if(oConfig.pauseMode=!0,_renderTextarea(e.text),n=document.getElementById(sTextareaId),"object"==typeof e.buttons){var t=document.createElement("div");t.style.position="absolute",t.style.bottom=0,t.style.left=0,t.style.height="20px",t.style.borderTopWidth="1px",t.style.borderTopStyle="solid",t.style.width="100%",t.style.paddingTop="5px";for(var _ in e.buttons)if(e.buttons.hasOwnProperty(_)){var i=document.createElement("button");i.innerHTML=_,i.onclick=e.buttons[_],i.style["float"]="left",t.appendChild(i)}n.appendChild(t)}}if(!document.body)return void console.warn("ticker-log: no dom found, exiting");var aChannels=["log","debug","warn","error","trace"],oChannels={},oDEFAULTS={interval:300,logStartTop:100,align:"left",requireBackTick:!0,channels:["log"]},oConfig={silentMode:!1,pauseMode:!1,adjustmentInterval:25,lastTextareaAction:void 0,sMacro9Code:"// macro 9\r\r",logStyle:{position:"fixed",color:"black","background-color":"#F2F2F2",padding:"1px","z-index":9998,top:0,left:0,"font-family":"monospace","font-size":"14px",opacity:.85}},aBuffer=[],aRenderBuffer=[],render_interval,aMacros={},iAllowedHeight=1.25*window.innerHeight,aConfigurableKeys=["interval","logStartTop","align","requireBackTick"],sTextareaId="_tickerTextarea",keyIsDown=!1,fnKeyDown,fnKeyUp,fnFilterFunction,aHelp=["___________________________________","ticker-log_________________________","___________________________________","Enter commands: `key_______________","___________________________________","h__-> help_________________________","t__-> test_________________________","p__-> pause (freeze output)________","k__-> kill (remove all)____________","o__-> output (show in textarea)____","l__-> output all (all past logging)","d__-> dump (show config values)____",'b__-> toggle api "`" requirement___',"0-9-> invoke macros________________","m__-> enter macro 9________________","___________________________________","up______-> increase speed__________","down____-> decrease speed__________","right___-> move logs right_________","left____-> move logs left__________","pageup__-> increase starting point_","pagedown-> decrease starting point_","tab_____-> change console channel__","___________________________________","enter -> save configuration in url_","___________________________________","Print to the screen:_______________",'__>> console.log("`", "hello...")__',"___________________________________","-__________________________________","-__________________________________","-__________________________________"],KEYS={Tab:9,Enter:13,Esc:27,PageDown:33,PageUp:34,Left:37,Up:38,Right:39,Down:40,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,H:72,K:75,L:76,M:77,O:79,P:80,S:83,T:84,BackTick:192},aActionKeys=[KEYS.Tab,KEYS.Esc,KEYS.PageDown,KEYS.PageUp,KEYS.Left,KEYS.Up,KEYS.Right,KEYS.Down,KEYS[0],KEYS[1],KEYS[2],KEYS[3],KEYS[4],KEYS[5],KEYS[6],KEYS[7],KEYS[8],KEYS[9],KEYS.A,KEYS.B,KEYS.C,KEYS.D,KEYS.H,KEYS.K,KEYS.L,KEYS.M,KEYS.O,KEYS.P,KEYS.S,KEYS.T];oDEFAULTS.defaultBacktickKeys=[KEYS.BackTick],aChannels.forEach(function(e){oChannels[e]={fnOriginal:console[e]}});for(var sKey in oDEFAULTS)oConfig[sKey]=oDEFAULTS[sKey];_loadConfigFromUrl(),_postConfigApply(),_listenToChannels(),setInterval(function(){_flushBuffer()},250),_startInterval(),_setupListeners(),function(){var e={};e.config=config,e.test=test,e.help=help,e.kill=kill,e.silent=silent,e.pause=pause,e.output=output,e.outputAll=outputAll,e.dump=dump,e.moveDown=increaseLogStartTop,e.moveUp=decreaseLogStartTop,e.moveLeft=moveLeft,e.moveRight=moveRight,e.increaseSpeed=increaseSpeed,e.decreaseSpeed=decreaseSpeed,e.nextChannel=nextChannel,e.print=print,e.registerMacro=registerMacro,e.runMacro=runMacro,e.filter=filter,e.listenToEverything=listenToEverything,e.macroEdit=macroEdit,e.restoreAndExit=restoreAndExit,e.reset=reset,e._oConfig=oConfig,window._ticker=e}()}();
