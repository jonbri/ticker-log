/*! ticker Apr-24-2016 */
!function(){function pseudoForEach(a,b,c){for(var d=0;d<a.length;d++)b.call(c,d,a[d])}function assignStyle(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])}function getUrlParamValue(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href);return null===d?null:d[1]}function config(a){for(var b in a)oConfig[b]=a[b]}function print(a,b){oConfig.silentMode===!0&&b&&!b.overrideSilentMode||(b&&b.textarea&&_renderTextarea(a),b&&b.internal!==!0&&aBuffer.unshift(a),aRenderBuffer.unshift(a),_flushBuffer())}function test(){return oConfig.pauseMode===!0?void _nonSavedPrint("pauseMode"):void print("test: "+new Date,{overrideSilentMode:!0})}function help(){oConfig.pauseMode=!1,kill(),oConfig.interval=oDEFAULTS.interval,oConfig.logStartTop=oDEFAULTS.logStartTop;for(var a=0;a<aHelp.length;a++){var b=aHelp[a];b=b.replace(/\_/g,"&nbsp;"),print(b,{overrideSilentMode:!0})}}function kill(){oConfig.pauseMode=!1,aRenderBuffer=[];var a=document.querySelectorAll("._ticker");pseudoForEach(a,function(a,b){b.parentNode.removeChild(b)})}function pause(){print(oConfig.pauseMode?"pause off":"paused"),oConfig.pauseMode=!oConfig.pauseMode}function output(a){void 0===a&&(a=!1);var b="";if(a===!0)aBuffer.forEach(function(a){b+=a+"\n"});else{var c=document.querySelectorAll("._ticker_log");c.length>0&&pseudoForEach(c,function(a,c){var d=c.innerHTML.trim();d=d.replace(/&nbsp;/g,""),b+=d+"\n"})}_toggleTextarea({text:b,source:KEYS.O})}function outputAll(){output(!0)}function dump(){var a="";aConfigurableKeys.forEach(function(b){a+=b+": "+oConfig[b]+"\n"}),a+="listening to console."+oConfig.channel+"\n",_toggleTextarea({text:a,source:KEYS.D})}function silent(){oConfig.silentMode===!0?(oConfig.silentMode=!1,print("silent mode off")):oConfig.silentMode=!0}function increaseSpeed(a){return oConfig.pauseMode?void _nonSavedPrint("pauseMode"):(oConfig.interval-=oConfig.adjustmentInterval/2,void print("speed: "+oConfig.interval))}function decreaseSpeed(a){return oConfig.pauseMode?void _nonSavedPrint("pauseMode"):(oConfig.interval+=oConfig.adjustmentInterval,void print("speed: "+oConfig.interval))}function moveRight(a){oConfig.align="right",_postConfigApply();var b=document.querySelectorAll("._ticker_log");pseudoForEach(b,function(a,b){b.style.right=0,b.style.left="inherit",b.style["text-align"]="right"}),test()}function moveLeft(a){oConfig.align="left",_postConfigApply();var b=document.querySelectorAll("._ticker_log");pseudoForEach(b,function(a,b){b.style.left=0,b.style.right="inherit",b.style["text-align"]="left"}),test()}function saveConfig(){function a(){var a="_ticker={";return aConfigurableKeys.forEach(function(b){void 0!==oDEFAULTS[b]&&oDEFAULTS[b]===oConfig[b]||(a+="%22"+b+"%22:",a+="string"==typeof oConfig[b]?"%22"+oConfig[b]+"%22":oConfig[b],a+=",")}),a+="}",a=a.replace(/,}/,"}")}var b=window.location.href;b=b.replace(/_ticker=({.*})?&?/,""),-1===b.indexOf("?")&&(b+="?1=1"),b=b+"&"+a(),b=b.replace(/\?1=1&/,"?"),b=b.replace(/\?&/,"?"),b=b.replace(/(&&)+/,"&"),window.location.replace(b)}function moveUp(a){return oConfig.pauseMode?void _nonSavedPrint("pauseMode"):(kill(),oConfig.logStartTop+=5,void print("start: "+oConfig.logStartTop))}function moveDown(a){return oConfig.pauseMode?void _nonSavedPrint("pauseMode"):(kill(),oConfig.logStartTop-=5,void print("start: "+oConfig.logStartTop))}function registerMacro(a,b){return 9===a?void console.log("`","macro 9 reserved for interactive macro (`m)"):(console.log("`","registering macro: "+a),void(aMacros[a]=b))}function macroEdit(){var sDefaultText=oConfig.sMacro9Code;_toggleTextarea({text:sDefaultText,source:KEYS.M,buttons:{clear:function(){killTextarea(),macroEdit()}},exit:function(sValue){oConfig.sMacro9Code=sValue,console.log("`","registering macro: 9"),aMacros[9]=function(){eval(sValue)}}})}function runMacro(a){"function"==typeof aMacros[a]?(console.log("`","running macro: "+a),aMacros[a]()):console.log("`","macro empty")}function nextChannel(){for(var a=0,b=oConfig.channel;a<aChannels.length&&aChannels[a]!==b;a++);_listenToChannel(aChannels[(a+1)%aChannels.length]),print("listening to "+oConfig.channel)}function killTextarea(){var a=document.getElementById(sTextareaId);a&&a.parentNode.removeChild(a)}function reset(){for(var a in oDEFAULTS)oConfig[a]=oDEFAULTS[a]}function _nonSavedPrint(a){print(a,{overrideSilentMode:!1,internal:!0})}function _startInterval(){var a=function(){if(clearInterval(b),!oConfig.pauseMode){var c=document.querySelectorAll("._ticker_log");c.length>0&&pseudoForEach(c,function(a,b){var c=parseInt(getComputedStyle(b).top,10);if(0>=c)b.parentNode.removeChild(b);else{var d=c-b.offsetHeight+"px";b.style.top=d}})}b=setInterval(a,oConfig.interval)},b=setInterval(a,oConfig.interval)}function _postConfigApply(){function a(){"right"===oConfig.align?(oConfig.logStyle.right=0,oConfig.logStyle.left="inherit",oConfig.logStyle["text-align"]="right"):(oConfig.logStyle.right="inherit",oConfig.logStyle.left=0,oConfig.logStyle["text-align"]="left")}a()}function _loadConfigFromUrl(){var a,b=getUrlParamValue("_ticker");if(null!==b){try{a=JSON.parse(decodeURIComponent(b))}catch(c){}if("object"==typeof a)for(var d in a)oConfig[d]=a[d]}}function _setupListeners(){document.body.addEventListener("keydown",function(a){if(keyIsDown===!1&&a.keyCode===KEYS.BackTick&&(keyIsDown=!0),keyIsDown===!0){a.preventDefault();var b={};b[KEYS.B]=function(){oConfig.requireBackTick=!oConfig.requireBackTick,print("requireBackTick: "+oConfig.requireBackTick)},b[KEYS.D]=dump,b[KEYS.S]=silent,b[KEYS.T]=test,b[KEYS.O]=output,b[KEYS.L]=outputAll,b[KEYS.P]=pause,b[KEYS.K]=kill,b[KEYS.H]=help,b[KEYS.M]=macroEdit,b[KEYS.Up]=increaseSpeed,b[KEYS.Down]=decreaseSpeed,b[KEYS.Right]=moveRight,b[KEYS.Left]=moveLeft,b[KEYS.PageDown]=moveDown,b[KEYS.PageUp]=moveUp,b[KEYS.Enter]=saveConfig,b[KEYS.Tab]=nextChannel,b[KEYS.Esc]=killTextarea,[0,1,2,3,4,5,6,7,8,9].forEach(function(a){b[KEYS[a]]=function(){runMacro(a)}}),"function"==typeof b[a.keyCode]&&b[a.keyCode]()}}),document.body.addEventListener("keyup",function(a){keyIsDown===!0&&-1===aActionKeys.indexOf(a.keyCode)&&(keyIsDown=!1)})}function _calculateTop(){var a=document.querySelector("._ticker_log:last-child");return a?parseInt(a.style.top,10)+a.offsetHeight:oConfig.logStartTop}function _renderText(a){var b=document.createElement("div");b.className="_ticker",assignStyle(b,oConfig.logStyle),b.className+=" _ticker_log",b.innerHTML=a,b.style.top=_calculateTop()+"px",document.body.appendChild(b)}function _flushBuffer(){for(;aRenderBuffer.length>0&&_calculateTop()<iAllowedHeight;)_renderText(aRenderBuffer.pop())}function _listenToChannel(a){var b=oConfig.channel;b&&"function"==typeof oChannels[b].fnOriginal&&(console[b]=oChannels[b].fnOriginal),oConfig.channel=a,console[a]=function(b,c){var d=b;"`"===b&&(d=c),oConfig.requireBackTick===!1?print(d):oConfig.requireBackTick===!0&&"`"===b?print(d):oChannels[a].fnOriginal.apply(this,[arguments])}}function _renderTextarea(a){var b=window.innerHeight,c=window.innerWidth,d=document.createElement("div");d.id=sTextareaId,d.style.position="fixed",d.style.left=0,d.style.top=0,d.style["z-index"]=9999,d.style.width=c/3+"px",d.style.height=b-10+"px";var e=document.createElement("textarea");e.style.height="100%",e.style.width="100%",e.innerHTML=a,d.appendChild(e),document.body.appendChild(d)}function _toggleTextarea(a){oConfig.lastTextareaAction!==a.source&&killTextarea(),oConfig.lastTextareaAction=a.source;var b;if(document.getElementById(sTextareaId)){if(oConfig.pauseMode=!1,"function"==typeof a.exit){b=document.getElementById(sTextareaId);var c=b.querySelectorAll("textarea")[0];a.exit(c.value)}killTextarea()}else if(oConfig.pauseMode=!0,_renderTextarea(a.text),b=document.getElementById(sTextareaId),"object"==typeof a.buttons){var d=document.createElement("div");d.style.position="absolute",d.style.bottom=0,d.style.left=0,d.style.height="20px",d.style.borderTopWidth="1px",d.style.borderTopStyle="solid",d.style.width="100%",d.style.paddingTop="5px";for(var e in a.buttons)if(a.buttons.hasOwnProperty(e)){var f=document.createElement("button");f.innerHTML=e,f.onclick=a.buttons[e],f.style["float"]="left",d.appendChild(f)}b.appendChild(d)}}var aChannels=["log","debug","warn","error","trace"],oChannels={},oDEFAULTS={interval:300,logStartTop:30,align:"left",requireBackTick:!0},oConfig={silentMode:!1,pauseMode:!1,channel:"log",adjustmentInterval:25,lastTextareaAction:void 0,sMacro9Code:"// macro 9\r\r",logStyle:{position:"fixed",color:"black","background-color":"#F2F2F2",padding:"1px","z-index":9998,top:0,left:0,"font-family":"monospace","font-size":"14px",opacity:.85}},aBuffer=[],aRenderBuffer=[],aMacros={},iAllowedHeight=1.25*window.innerHeight,aConfigurableKeys=["interval","logStartTop","align","requireBackTick"],sTextareaId="_tickerTextarea",keyIsDown=!1,aHelp=["________________________________________________","ticker__________________________________________","________________________________________________","Hold_the_backtick_(`)_key_down_to_enter_commands","________________________________________________","h_->_help_______________________________________","t_->_test_______________________________________","p_->_pause_(freeze_output_toggle)_______________","k_->_kill_(remove_all)__________________________","o_->_output_(show_output_in_textarea_toggle)____","0_->_output_all_(show_entire_log_history)_______","d_->_dump_(show_configuration_values)___________","b_->_back-tick_required_to_console_invocation___","________________________________________________","up_______->_increase_speed______________________","down_____->_decrease_speed______________________","right____->_move logs right_____________________","left_____->_move logs left______________________","pageup___->_increase_starting_point_____________","pagedown_->_decrease_starting_point_____________","________________________________________________","enter_->_save_configuration_in_url______________","c_____->_clear_configuration_in_url_____________","________________________________________________","________________________________________________","Print_to_the_screen:____________________________",'__>> console.log("`", _"lorum_ipsum...")________',"________________________________________________","-","-","-"],KEYS={Tab:9,Enter:13,Esc:27,PageDown:33,PageUp:34,Left:37,Up:38,Right:39,Down:40,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,H:72,K:75,L:76,M:77,O:79,P:80,S:83,T:84,BackTick:192},aActionKeys=[KEYS.Tab,KEYS.Esc,KEYS.PageDown,KEYS.PageUp,KEYS.Left,KEYS.Up,KEYS.Right,KEYS.Down,KEYS[0],KEYS[1],KEYS[2],KEYS[3],KEYS[4],KEYS[5],KEYS[6],KEYS[7],KEYS[8],KEYS[9],KEYS.A,KEYS.B,KEYS.C,KEYS.D,KEYS.H,KEYS.K,KEYS.L,KEYS.M,KEYS.O,KEYS.P,KEYS.S,KEYS.T];aChannels.forEach(function(a){oChannels[a]={fnOriginal:console[a]}}),reset(),_loadConfigFromUrl(),_postConfigApply(),_listenToChannel(oConfig.channel),setInterval(function(){_flushBuffer()},250),_startInterval(),_setupListeners(),function(){var a={};a.config=config,a.test=test,a.help=help,a.kill=kill,a.silent=silent,a.pause=pause,a.output=output,a.outputAll=outputAll,a.dump=dump,a.moveDown=moveDown,a.moveUp=moveUp,a.moveLeft=moveLeft,a.moveRight=moveRight,a.increaseSpeed=increaseSpeed,a.decreaseSpeed=decreaseSpeed,a.nextChannel=nextChannel,a.reset=reset,a.print=print,a.registerMacro=registerMacro,a._oConfig=oConfig,window._ticker=a}()}();